<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Directional Shooting Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: lightblue;
            user-select: none; /* Disables text selection */
        }

        img {
            user-select: none;
            position: absolute;
        }

        .bullet {
            width: 10px;
            height: 10px;
            background-color: green;
            position: absolute;
            border-radius: 50%;
        }

        .enemy-bullet {
            background-color: red;
        }
    </style>
</head>
<body>

    <!-- Game Elements -->
    <img id="myImg01" src="MainCharacterRight.png" style="width:100px; height:80px; left:50px; top:200px;">
    <img id="myImg02" src="Enemy.png" style="width:100px; height:80px; left:500px; top:200px;">

    <script>
        // Game Variables
        const player = document.getElementById("myImg01");
        const enemy = document.getElementById("myImg02");
        const speed = 3; // Movement speed
        const bulletSpeed = 7; // Speed of bullets
        const bullets = [];
        const enemyBullets = [];
        let lastDirection = "right"; // Default shooting direction
        const keyState = {}; // Track keys

        // Directions for movement and shooting
        const directionMap = {
            up: { x: 0, y: -1 },
            down: { x: 0, y: 1 },
            left: { x: -1, y: 0 },
            right: { x: 1, y: 0 },
        };

        // Track Key Presses
        document.onkeydown = function (event) {
            keyState[event.key] = true;
            if (event.key === "ArrowUp") lastDirection = "up";
            if (event.key === "ArrowRight") lastDirection = "right";
            if (event.key === "ArrowDown") lastDirection = "down";
            if (event.key === "ArrowLeft") lastDirection = "left";
        };

        document.onkeyup = function (event) {
            keyState[event.key] = false;
        };

        // Create Bullet with Direction
        function createBullet(x, y, direction, isPlayer = true) {
            const bullet = document.createElement("div");
            bullet.className = isPlayer ? "bullet" : "bullet enemy-bullet";
            bullet.style.left = `${x}px`;
            bullet.style.top = `${y}px`;
            bullet.direction = direction; // Add direction to bullet object
            document.body.appendChild(bullet);
            if (isPlayer) bullets.push(bullet);
            else enemyBullets.push(bullet);
        }

        // Move Bullets
        function moveBullets() {
            // Move player bullets
            bullets.forEach((bullet, index) => {
                let left = parseInt(bullet.style.left);
                let top = parseInt(bullet.style.top);

                // Update position based on direction
                left += bullet.direction.x * bulletSpeed;
                top += bullet.direction.y * bulletSpeed;

                bullet.style.left = `${left}px`;
                bullet.style.top = `${top}px`;

                // Remove bullet if out of bounds
                if (
                    left < 0 ||
                    left > window.innerWidth ||
                    top < 0 ||
                    top > window.innerHeight
                ) {
                    bullet.remove();
                    bullets.splice(index, 1);
                }

                // Collision with enemy
                if (myHitOther(bullet, enemy)) {
                    alert("Enemy hit!");
                    bullet.remove();
                    bullets.splice(index, 1);
                }
            });

            // Move enemy bullets
            enemyBullets.forEach((bullet, index) => {
                let left = parseInt(bullet.style.left) + bullet.direction.x * bulletSpeed;
                let top = parseInt(bullet.style.top) + bullet.direction.y * bulletSpeed;

                bullet.style.left = `${left}px`;
                bullet.style.top = `${top}px`;

                // Remove bullet if out of bounds
                if (
                    left < 0 ||
                    left > window.innerWidth ||
                    top < 0 ||
                    top > window.innerHeight
                ) {
                    bullet.remove();
                    enemyBullets.splice(index, 1);
                }

                // Collision with player
                if (myHitOther(bullet, player)) {
                    alert("You got hit!");
                    bullet.remove();
                    enemyBullets.splice(index, 1);
                    player.style.left = "50px"; // Reset position
                    player.style.top = "200px";
                }
            });
        }

        // Custom Collision Detection
        function myHitOther(my1, my2) {
            const left1 = parseInt(my1.style.left);
            const top1 = parseInt(my1.style.top);
            const right1 = left1 + my1.offsetWidth;
            const bottom1 = top1 + my1.offsetHeight;

            const left2 = parseInt(my2.style.left);
            const top2 = parseInt(my2.style.top);
            const right2 = left2 + my2.offsetWidth;
            const bottom2 = top2 + my2.offsetHeight;

            return (
                right1 >= left2 &&
                bottom1 >= top2 &&
                left1 <= right2 &&
                top1 <= bottom2
            );
        }

        // Main Game Loop
        function moveCharacter() {
            let left = parseInt(player.style.left);
            let top = parseInt(player.style.top);

            // Movement Logic (WASD only)
            if (keyState["d"]) left += speed; // Right
            if (keyState["a"]) left -= speed; // Left
            if (keyState["s"]) top += speed; // Down
            if (keyState["w"]) top -= speed; // Up

            // Fire Player Bullet (Space)
            if (keyState[" "]) {
                const direction = directionMap[lastDirection];
                createBullet(left + 45, top + 35, direction); // Shoot from player center
                keyState[" "] = false; // Prevent rapid firing
            }

            // Enemy Firing Logic
            if (Math.random() < 0.02) {
                const playerLeft = parseInt(player.style.left) + 50; // Center player
                const playerTop = parseInt(player.style.top) + 40;
                const enemyLeft = parseInt(enemy.style.left) + 50; // Center enemy
                const enemyTop = parseInt(enemy.style.top) + 40;
                const diffX = playerLeft - enemyLeft;
                const diffY = playerTop - enemyTop;
                const magnitude = Math.sqrt(diffX ** 2 + diffY ** 2);
                const unitVector = { x: diffX / magnitude, y: diffY / magnitude }; // Normalize
                createBullet(enemyLeft, enemyTop, unitVector, false);
            }

            // Update Player Position
            player.style.left = `${left}px`;
            player.style.top = `${top}px`;

            // Move Bullets
            moveBullets();

            // Loop Animation
            setTimeout(moveCharacter, 16); // Approx. 60 FPS
        }

        // Start the Game Loop
        moveCharacter();
    </script>

</body>
</html>
