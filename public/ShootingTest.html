<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Directional Shooting Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: lightblue;
            user-select: none;
        }

        img {
            user-select: none;
            position: absolute;
        }

        .bullet {
            width: 10px;
            height: 10px;
            background-color: green;
            position: absolute;
            border-radius: 50%;
        }

        .enemy-bullet {
            background-color: red;
        }
    </style>
</head>
<body>

    <!-- Game Elements -->
    <img id="myImg01" src="MainCharacterRight.png" style="width:100px; height:80px; left:50px; top:200px;">
    <img id="myImg02" src="Enemy.png" style="width:100px; height:80px; left:calc(50% - 50px); top:10px;">
    <img id="myImg03" src="WinFlag.png" style="width:100px; height:50px; left:calc(100% - 110px); top:200px;">

    <script>
        const player = document.getElementById("myImg01");
        const enemy = document.getElementById("myImg02");
        const flag = document.getElementById("myImg03");

        const speed = 3;
        const bulletSpeed = 7;
        const bullets = [];
        const enemyBullets = [];
        let lastDirection = "right";
        const keyState = {};

        const directionMap = {
            up: { x: 0, y: -1 },
            down: { x: 0, y: 1 },
            left: { x: -1, y: 0 },
            right: { x: 1, y: 0 },
        };

        document.onkeydown = function (event) {
            keyState[event.key] = true;
            if (["ArrowUp", "ArrowRight", "ArrowDown", "ArrowLeft"].includes(event.key)) {
                lastDirection = event.key.replace("Arrow", "").toLowerCase();
            }
        };

        document.onkeyup = function (event) {
            keyState[event.key] = false;
        };

        function createBullet(x, y, direction, isPlayer = true) {
            const bullet = document.createElement("div");
            bullet.className = isPlayer ? "bullet" : "bullet enemy-bullet";
            bullet.style.left = `${x}px`;
            bullet.style.top = `${y}px`;
            bullet.direction = direction;
            document.body.appendChild(bullet);
            (isPlayer ? bullets : enemyBullets).push(bullet);
        }

        function moveBullets() {
            const removeOffscreenBullets = (bulletArray) => {
                for (let i = bulletArray.length - 1; i >= 0; i--) {
                    const bullet = bulletArray[i];
                    const left = parseInt(bullet.style.left) + bullet.direction.x * bulletSpeed;
                    const top = parseInt(bullet.style.top) + bullet.direction.y * bulletSpeed;

                    bullet.style.left = `${left}px`;
                    bullet.style.top = `${top}px`;

                    if (
                        left < 0 || left > window.innerWidth ||
                        top < 0 || top > window.innerHeight
                    ) {
                        bullet.remove();
                        bulletArray.splice(i, 1);
                    }
                }
            };

            removeOffscreenBullets(bullets);
            removeOffscreenBullets(enemyBullets);
        }

        function checkCollisions() {
            bullets.forEach((bullet, i) => {
                if (myHitOther(bullet, enemy)) {
                    alert("Enemy hit!");
                    bullet.remove();
                    bullets.splice(i, 1);
                }
            });

            enemyBullets.forEach((bullet, i) => {
                if (myHitOther(bullet, player)) {
                    alert("You got hit!");
                    bullet.remove();
                    enemyBullets.splice(i, 1);
                    player.style.left = "50px";
                    player.style.top = "200px";
                }
            });

            if (myHitOther(player, flag)) {
                alert("You win!");
                location.reload();
            }
        }

        function myHitOther(my1, my2) {
            const rect1 = my1.getBoundingClientRect();
            const rect2 = my2.getBoundingClientRect();
            return !(
                rect1.right < rect2.left ||
                rect1.left > rect2.right ||
                rect1.bottom < rect2.top ||
                rect1.top > rect2.bottom
            );
        }

        function startEnemyFiring() {
    setInterval(() => {
        // Get the enemy's current position from the bounding rectangle
        const enemyRect = enemy.getBoundingClientRect();
        const enemyLeft = enemyRect.left + enemyRect.width / 2;
        const enemyTop = enemyRect.top + enemyRect.height / 2;

        // Get the player's current position from the bounding rectangle
        const playerRect = player.getBoundingClientRect();
        const playerLeft = playerRect.left + playerRect.width / 2;
        const playerTop = playerRect.top + playerRect.height / 2;

        // Calculate the direction vector from the enemy to the player
        const diffX = playerLeft - enemyLeft;
        const diffY = playerTop - enemyTop;
        const magnitude = Math.sqrt(diffX ** 2 + diffY ** 2);

        // Avoid division by zero
        if (magnitude === 0) return;

        const unitVector = { x: diffX / magnitude, y: diffY / magnitude };

        // Create and shoot the bullet
        createBullet(enemyLeft, enemyTop, unitVector, false);
    }, 1000); // Fire every second
}

        function moveCharacter() {
            const left = parseInt(player.style.left);
            const top = parseInt(player.style.top);

            const newX = left + (keyState["d"] ? speed : 0) - (keyState["a"] ? speed : 0);
            const newY = top + (keyState["s"] ? speed : 0) - (keyState["w"] ? speed : 0);

            if (newX >= 0 && newX + player.offsetWidth <= window.innerWidth) {
                player.style.left = `${newX}px`;
            }

            if (newY >= 0 && newY + player.offsetHeight <= window.innerHeight) {
                player.style.top = `${newY}px`;
            }

            if (keyState[" "]) {
                const direction = directionMap[lastDirection];
                createBullet(newX + 45, newY + 35, direction);
                keyState[" "] = false;
            }
        }

        function gameLoop() {
            moveCharacter();
            moveBullets();
            checkCollisions();
            requestAnimationFrame(gameLoop);
        }

        startEnemyFiring();
        gameLoop();
    </script>
</body>
</html>
