<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Directional Shooting Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: lightblue;
            user-select: none;
        }

        img {
            user-select: none;
            position: absolute;
        }

        .bullet {
            width: 10px;
            height: 10px;
            background-color: green;
            position: absolute;
            border-radius: 50%;
        }

        .enemy-bullet {
            background-color: red;
        }
    </style>
</head>
<body>

    <!-- Game Elements -->
    <img id="myImg01" src="MainCharacterRight.png" style="width:100px; height:80px; left:50px; top:200px;">
    <img id="myImg02" src="Enemy.png" style="width:100px; height:80px; left:calc(50% - 50px); top:10px;">
    <img id="myImg03" src="WinFlag.png" style="width:100px; height:50px; left:calc(100% - 110px); top:200px;">

    <script>
        // Game Variables
        const player = document.getElementById("myImg01");
        const enemy = document.getElementById("myImg02");
        const flag = document.getElementById("myImg03");
        const speed = 3;
        const bulletSpeed = 7;
        const bullets = [];
        const enemyBullets = [];
        let lastDirection = "right";
        const keyState = {};

        // Directions for movement and shooting
        const directionMap = {
            up: { x: 0, y: -1 },
            down: { x: 0, y: 1 },
            left: { x: -1, y: 0 },
            right: { x: 1, y: 0 },
        };

        // Track Key Presses
        document.onkeydown = function (event) {
            keyState[event.key] = true;
            if (event.key === "ArrowUp") lastDirection = "up";
            if (event.key === "ArrowRight") lastDirection = "right";
            if (event.key === "ArrowDown") lastDirection = "down";
            if (event.key === "ArrowLeft") lastDirection = "left";
        };

        document.onkeyup = function (event) {
            keyState[event.key] = false;
        };

        // Create Bullet with Direction
        function createBullet(x, y, direction, isPlayer = true) {
            const bullet = document.createElement("div");
            bullet.className = isPlayer ? "bullet" : "bullet enemy-bullet";
            bullet.style.left = `${x}px`;
            bullet.style.top = `${y}px`;
            bullet.direction = direction;
            document.body.appendChild(bullet);
            if (isPlayer) bullets.push(bullet);
            else enemyBullets.push(bullet);
        }

        // Move Bullets
        function moveBullets() {
            // Move player bullets
            bullets.forEach((bullet, index) => {
                let left = parseInt(bullet.style.left);
                let top = parseInt(bullet.style.top);

                left += bullet.direction.x * bulletSpeed;
                top += bullet.direction.y * bulletSpeed;

                bullet.style.left = `${left}px`;
                bullet.style.top = `${top}px`;

                if (
                    left < 0 ||
                    left > window.innerWidth ||
                    top < 0 ||
                    top > window.innerHeight
                ) {
                    bullet.remove();
                    bullets.splice(index, 1);
                }

                if (myHitOther(bullet, enemy)) {
                    alert("Enemy hit!");
                    bullet.remove();
                    bullets.splice(index, 1);
                }
            });

            // Move enemy bullets
            enemyBullets.forEach((bullet, index) => {
                let left = parseInt(bullet.style.left) + bullet.direction.x * bulletSpeed;
                let top = parseInt(bullet.style.top) + bullet.direction.y * bulletSpeed;

                bullet.style.left = `${left}px`;
                bullet.style.top = `${top}px`;

                if (
                    left < 0 ||
                    left > window.innerWidth ||
                    top < 0 ||
                    top > window.innerHeight
                ) {
                    bullet.remove();
                    enemyBullets.splice(index, 1);
                }

                if (myHitOther(bullet, player)) {
                    alert("You got hit!");
                    bullet.remove();
                    enemyBullets.splice(index, 1);
                    player.style.left = "50px";
                    player.style.top = "200px";
                }
            });
        }

        // Improved Collision Detection
        function myHitOther(my1, my2) {
            const rect1 = my1.getBoundingClientRect();
            const rect2 = my2.getBoundingClientRect();

            return !(
                rect1.right < rect2.left ||
                rect1.left > rect2.right ||
                rect1.bottom < rect2.top ||
                rect1.top > rect2.bottom
            );
        }

        // Main Game Loop
        function moveCharacter() {
            let left = parseInt(player.style.left);
            let top = parseInt(player.style.top);

            if (keyState["d"]) left += speed;
            if (keyState["a"]) left -= speed;
            if (keyState["s"]) top += speed;
            if (keyState["w"]) top -= speed;

            if (keyState[" "]) {
                const direction = directionMap[lastDirection];
                createBullet(left + 45, top + 35, direction);
                keyState[" "] = false;
            }

            if (Math.random() < 0.02) {
                const playerLeft = parseInt(player.style.left) + 50;
                const playerTop = parseInt(player.style.top) + 40;
                const enemyLeft = parseInt(enemy.style.left) + 50;
                const enemyTop = parseInt(enemy.style.top) + 40;
                const diffX = playerLeft - enemyLeft;
                const diffY = playerTop - enemyTop;
                const magnitude = Math.sqrt(diffX ** 2 + diffY ** 2);
                const unitVector = { x: diffX / magnitude, y: diffY / magnitude };
                createBullet(enemyLeft, enemyTop, unitVector, false);
            }

            if (myHitOther(player, flag)) {
                alert("You Win!");
                return;
            }

            player.style.left = `${left}px`;
            player.style.top = `${top}px`;

            moveBullets();
            setTimeout(moveCharacter, 16);
        }

        moveCharacter();
    </script>

</body>
</html>
