<body 
  id="myBody" 
  style="background-repeat: no-repeat; background-size: 100%; background: url('https://cdn.wallpapersafari.com/55/17/3NeORi.png');"
  onkeydown="handleKeyDown(event)"
  onkeyup="handleKeyUp(event)"
  tabindex="0"  <!-- Added tabindex to make the body focusable -->
>
  <h1 align="center">Andy Final Game</h1>
  <br><br><br><br>

  <script>
    let characterSpeed = 10; // Speed of movement
    let isJumping = false;  // Prevent multiple jumps

    // Initialize the position of the character
    window.onload = function() {
      const myImg = document.getElementById("myImg01");
      myImg.style.left = "50px"; // Set initial left position
      myImg.style.top = "200px"; // Set initial top position
    };

    function handleKeyDown(event) {
      const key = event.key;
      const myImg = document.getElementById("myImg01");

      if (key === "d") { // Move Right
        setCharacter("Right");
        myImg.style.left = (parseInt(myImg.style.left) || 0) + characterSpeed + "px";
        myCheckHit();
        myCheckWin();
      } else if (key === "a") { // Move Left
        setCharacter("Left");
        myImg.style.left = (parseInt(myImg.style.left) || 0) - characterSpeed + "px";
        myCheckHit();
        myCheckWin();
      } else if (key === "w" && !isJumping) { // Jump
        setCharacter("Jump");
        myJump();
      }
    }

    function handleKeyUp(event) {
      const key = event.key;
      if (key === "w") {
        // Reset to default after jump
        const myImg = document.getElementById("myImg01");
        if (!isJumping) {
          setCharacter("Right"); // Set to right if not jumping
        }
      }
    }

    function setCharacter(action) {
      const myImg = document.getElementById("myImg01");
      myImg.src = `MainCharacter${action}.png`;
    }

    function myJump() {
      isJumping = true;
      const myImg = document.getElementById("myImg01");
      const startPos = parseInt(myImg.style.top);
      let currentHeight = 0;
      const jumpHeight = 130;
      const gravity = 5;

      function jumpUp() {
        if (currentHeight < jumpHeight) {
          currentHeight += gravity;
          myImg.style.top = startPos - currentHeight + "px";
          requestAnimationFrame(jumpUp);
        } else {
          jumpDown();
        }
      }

      function jumpDown() {
        if (currentHeight > 0) {
          currentHeight -= gravity;
          myImg.style.top = startPos - currentHeight + "px";
          requestAnimationFrame(jumpDown);
        } else {
          isJumping = false;
          setCharacter("Right"); // Reset to right after jump
        }
      }

      jumpUp();
    }

    function myCheckHit() {
      if (myHitOther("myImg01", "myImg02")) {
        alert("You lose! Click 'Space' to restart");
        location.reload();
      }
    }

    function myCheckWin() {
      if (myHitOther("myImg01", "myImg03")) {
        alert("You win! Click 'Space' to proceed.");
        location = "t2a13-keydown.html";
      }
    }

    function myHitOther(my1, my2) {
      const rect1 = document.getElementById(my1).getBoundingClientRect();
      const rect2 = document.getElementById(my2).getBoundingClientRect();
      return (
        rect1.right >= rect2.left &&
        rect1.left <= rect2.right &&
        rect1.bottom >= rect2.top &&
        rect1.top <= rect2.bottom
      );
    }
  </script>

  <img id="myImg01" style="position: absolute; width: 100px; height: 80px; top: 200px; left: 50px;" src="MainCharacterRight.png">
  <img id="myImg02" style="position: absolute; width: 100px; height: 80px; top: 200px; left: 250px;" src="MainCharacterLeft.png">
  <img id="myImg03" style="position: absolute; width: 100px; height: 80px; top: 200px; left: 400px;" src="MainCharacterJump.png">

  <input type="button" value="Image Right Fast Button" onclick="
    document.getElementById('myImg01').style.left = 
    parseInt(document.getElementById('myImg01').style.left) + 10 + 'px';
    myCheckHit();
  ">
  <br><br>

  <div id="myDiv01" style="color: yellow">..</div>
</body>
