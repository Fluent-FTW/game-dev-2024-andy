<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy Final Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 200vh;
            background: #add8e6 100%;
        }
        #myImg01 {
            position: absolute;
            width: 100px;
            height: 80px;
            top: 400px;
            left: 150px; /* Ensure valid starting position */
        }
    </style>
</head>
<body onkeydown="handleKeyDown(event)" onkeyup="handleKeyUp(event)">

<div id="gameContainer">
    <h1 align="center" style="position: absolute; top: 20px; width: 100%; color: black;">Andy Final Game</h1>

    <!-- Character -->
    <img id="myImg01" src="MainCharacterRight.png" style="top: 400px; left: 150px;" />

    <!-- Win/Lose Triggers -->
    <img id="myImg02" style="position: absolute; width: 100px; height: 80px; top: 500px; left: 250px;" src="myImage02.jpg" />
    <img id="myImg03" style="position: absolute; width: 100px; height: 80px; top: 50px; left: 400px;" src="myImage03.jpg" />

    <!-- Platform -->
    <div class="platform" style="position: absolute; width: 200px; height: 20px; top: 1200px; left: 300px; background-color: grey;"></div>
</div>

<script>
    // Global variables
    let isJumping = false;
    let keyState = {}; // Track key states
    const characterSpeed = 3;
    const jumpHeight = 130;
    const gravity = 5;

    // Key controls
    function handleKeyDown(event) {
        keyState[event.key] = true; // Track key press
        if (event.key === "w" && !isJumping) myJump();
    }

    function handleKeyUp(event) {
        keyState[event.key] = false; // Track key release
    }

    function setCharacter(action) {
        const myImg = document.getElementById("myImg01");
        if (!isJumping) myImg.src = `MainCharacter${action}.png`; // Change the sprite
    }

    // Character movement
    function gameLoop() {
        const myImg = document.getElementById("myImg01");

        let currentLeft = parseInt(myImg.style.left, 10) || 0;

        if (keyState["d"]) {
            setCharacter("Right");
            currentLeft += characterSpeed;
            myImg.style.left = currentLeft + "px";
        }
        if (keyState["a"]) {
            setCharacter("Left");
            currentLeft -= characterSpeed;
            myImg.style.left = currentLeft + "px";
        }

        requestAnimationFrame(gameLoop);
    }

    // Character jump
  function myJump() {
    if (isJumping) return; // Prevent multiple jumps
    isJumping = true;

    const myImg = document.getElementById("myImg01");
    const startPos = parseInt(myImg.style.top, 10) || 400;
    let currentHeight = 0;

    myImg.src = 'MainCharacterJump.png'; // Switch to jumping animation

    // Jump up logic
    function jumpUp() {
        if (currentHeight < jumpHeight) {
            currentHeight += gravity; // Go up
            myImg.style.top = (startPos - currentHeight) + "px";
            requestAnimationFrame(jumpUp);
        } else {
            jumpDown(); // Start falling
        }
    }

    // Jump down logic
    function jumpDown() {
        // Switch to falling animation once the character reaches the peak and starts falling
        if (currentHeight >= jumpHeight && myImg.src.indexOf('Fall.png') === -1) {
            myImg.src = 'MainCharacterFall.png'; // Change to fall sprite when starting to fall
        }

        // Fall down by reducing height
        if (currentHeight > 0) { 
            currentHeight -= gravity; // Go down
            myImg.style.top = (startPos - currentHeight) + "px"; 
            requestAnimationFrame(jumpDown);
        } else {
            myImg.style.top = startPos + "px"; // Reset to start position after falling completely
            isJumping = false;
            myImg.src = 'MainCharacterRight.png'; // Reset to idle animation
        }
    }

    jumpUp(); // Start jump
}

    // Start the game loop
    gameLoop();
</script>
</body>
</html>
