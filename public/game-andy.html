<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy Final Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: lightblue;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #myImg01 {
            position: absolute;
            width: 100px;
            height: 80px;
            left: 10px;
            bottom: 0;
        }

        .platform {
            position: absolute;
            bottom: 100px;
            left: 150px;
            width: 200px;
            height: 20px;
            background-color: grey;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <img id="myImg01" src="MainCharacterRight.png" alt="Character">
        <div class="platform"></div>
    </div>

    <script>
        let isJumping = false;
        let isFalling = false;
        const keyState = {
            w: false,
            a: false,
            d: false
        };
        const characterSpeed = 3;
        const gravity = 3;
        const jumpSpeed = 15;

        const gameContainer = document.getElementById("gameContainer");
        const myImg = document.getElementById("myImg01");
        const platforms = document.querySelectorAll(".platform");

        myImg.style.left = "10px";
        myImg.style.bottom = "0px";

        function moveCharacter() {
            let currentLeft = parseFloat(myImg.style.left) || 0;

            if (keyState.d) {
                if (!isJumping && !isFalling) {
                    myImg.src = "MainCharacterRight.png";
                }
                if (currentLeft + myImg.offsetWidth < gameContainer.offsetWidth) {
                    currentLeft += characterSpeed;
                    myImg.style.left = currentLeft + "px";
                }
            }

            if (keyState.a) {
                if (!isJumping && !isFalling) {
                    myImg.src = "MainCharacterLeft.png";
                }
                if (currentLeft > 0) {
                    currentLeft -= characterSpeed;
                    myImg.style.left = currentLeft + "px";
                }
            }
        }

        function jump() {
            if (isJumping || isFalling) return;

            isJumping = true;
            let jumpVelocity = jumpSpeed;
            myImg.src = "MainCharacterJump.png";

            function handleJump() {
                let currentBottom = parseFloat(myImg.style.bottom) || 0;

                if (jumpVelocity > 0) {
                    currentBottom += jumpVelocity;
                    jumpVelocity -= 1;
                    myImg.style.bottom = currentBottom + "px";
                    requestAnimationFrame(handleJump);
                } else {
                    isJumping = false;
                    isFalling = true;
                    myImg.src = "MainCharacterFall.png";
                    handleFall();
                }
            }

            handleJump();
        }

        function handleFall() {
            let currentBottom = parseFloat(myImg.style.bottom) || 0;
            let isOnPlatform = false;

            for (let platform of platforms) {
                const platformRect = platform.getBoundingClientRect();
                const characterRect = myImg.getBoundingClientRect();

                if (
                    characterRect.right > platformRect.left &&
                    characterRect.left < platformRect.right &&
                    currentBottom <= gameContainer.offsetHeight - platformRect.top &&
                    currentBottom >= gameContainer.offsetHeight - platformRect.top - 5
                ) {
                    isFalling = false;
                    myImg.src = "MainCharacterRight.png";
                    isOnPlatform = true;
                    myImg.style.bottom =
                        (gameContainer.offsetHeight - platformRect.top) + "px";
                    break;
                }
            }

            if (!isOnPlatform) {
                if (currentBottom > 0) {
                    currentBottom -= gravity;
                    myImg.style.bottom = currentBottom + "px";
                    requestAnimationFrame(handleFall);
                } else {
                    isFalling = false;
                    myImg.src = "MainCharacterRight.png";
                    myImg.style.bottom = "0px";
                }
            }
        }

        function gameLoop() {
            moveCharacter();

            if (keyState.w) jump();

            requestAnimationFrame(gameLoop);
        }

        // Inline key events
        window.onkeydown = (event) => {
            keyState[event.key] = true;
        };

        window.onkeyup = (event) => {
            keyState[event.key] = false;
        };

        gameLoop();
    </script>
</body>
</html>
