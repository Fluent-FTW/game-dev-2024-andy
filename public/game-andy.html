<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy Final Game</title>
    <style>
        body {
            background-repeat: no-repeat;
            background-size: 100%;
            background-image: url('https://cdn.wallpapersafari.com/55/17/3NeORi.png');
        }
        #myImg01 {
            position: absolute;
            width: 100px;
            height: 80px;
            top: 200px;
            left: 150px;
        }
    </style>
</head>
<body id="myBody" onkeydown="handleKeyDown(event)" onkeyup="handleKeyUp(event)">

<h1 align="center">Andy Final Game</h1>
<br><br><br><br>

<img id="myImg01" src="MainCharacterRight.png">
<img id="myImg02" style="position:absolute; width:100px; height:80px; top:200px; left:250px;" src="myImage02.jpg">
<img id="myImg03" style="position:absolute; width:100px; height:80px; top:200px; left:400px;" src="myImage03.jpg">

<div id="myDiv01" style="color:yellow">..</div>

<script>
    // Global variables
    let isJumping = false; // Prevent multiple jumps
    let keyState = {}; // Track pressed keys
    const characterSpeed = 3; // Movement speed for smooth transitions
    const jumpHeight = 130; // Max height for the jump
    const gravity = 5; // Gravity effect during jump

    function handleKeyDown(event) {
        keyState[event.key] = true; // Track key press
        if (event.key === "w" && !isJumping) {
            myJump(); // Start jump
        }
    }

    function handleKeyUp(event) {
        keyState[event.key] = false; // Track key release
    }

    function gameLoop() {
        const myImg = document.getElementById("myImg01");

        // Handle horizontal movement
        if (!isJumping) {
            if (keyState["d"]) {
                setCharacter("Right");
                myImg.style.left = (parseInt(myImg.style.left, 10) || 0) + characterSpeed + "px";
            }
            if (keyState["a"]) {
                setCharacter("Left");
                myImg.style.left = (parseInt(myImg.style.left, 10) || 0) - characterSpeed + "px";
            }
        } else {
            // Allow horizontal movement during jump
            if (keyState["d"]) {
                myImg.style.left = (parseInt(myImg.style.left, 10) || 0) + characterSpeed + "px";
            }
            if (keyState["a"]) {
                myImg.style.left = (parseInt(myImg.style.left, 10) || 0) - characterSpeed + "px";
            }
        }

        // Continue the loop
        requestAnimationFrame(gameLoop);
    }

    function setCharacter(action) {
        const myImg = document.getElementById("myImg01");
        if (!isJumping) {
            myImg.src = `MainCharacter${action}.png`; // Change the sprite
        }
    }

    function myJump() {
        if (isJumping) return; // Prevent multiple jumps
        isJumping = true;

        const myImg = document.getElementById("myImg01");
        const startPos = parseInt(myImg.style.top, 10) || 200; // Default to 200 if not set
        let currentHeight = 0; // Track how high the character has jumped

        // Change to jump sprite
        myImg.src = 'MainCharacterJump.png';

        function jumpUp() {
            if (currentHeight < jumpHeight) {
                currentHeight += gravity; // Ascend
                myImg.style.top = (startPos - currentHeight) + "px"; // Update position
                requestAnimationFrame(jumpUp);
            } else {
                jumpDown(); // Start descending after reaching max height
            }
        }

        function jumpDown() {
            if (currentHeight > 0) {
                currentHeight -= gravity; // Descend
                myImg.src = 'MainCharacterFall.png';
                myImg.style.top = (startPos - currentHeight) + "px"; // Update position
                requestAnimationFrame(jumpDown);
            } else {
                // Reset jump state after landing
                isJumping = false;
                myImg.src = 'MainCharacterRight.png'; // Default sprite
                myImg.style.top = startPos + "px"; // Ensure position reset
            }
        }

        jumpUp(); // Begin upward motion
    }

    // Start the game loop
    gameLoop();
</script>

</body>
</html>
