<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy Final Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: lightblue;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: lightblue;
        }

        #myImg01 {
            position: absolute;
            width: 100px;
            height: 80px;
            left: 10px;
            bottom: 0;
        }

        .platform {
            position: absolute;
            bottom: 100px;
            left: 150px;
            width: 200px;
            height: 20px;
            background-color: grey;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <img id="myImg01" src="MainCharacterRight.png" alt="Character">
        <div class="platform"></div>
    </div>

    <script>
        // Global variables
      // Global variables
let isJumping = false;
let keyState = {};
const characterSpeed = 3;
const gravity = 2; // Slower gravity for smoother falling
const jumpSpeed = 15; // Higher speed for higher jumps

window.onload = () => {
    const myImg = document.getElementById("myImg01");
    const platformElements = document.querySelectorAll('.platform');
    const gameContainer = document.getElementById("gameContainer");

    function gameLoop() {
        let currentLeft = parseInt(myImg.style.left) || 10;
        let currentBottom = parseInt(myImg.style.bottom) || 0;
        const containerWidth = gameContainer.offsetWidth;
        const characterWidth = myImg.offsetWidth;
        const characterHeight = myImg.offsetHeight;

        // Horizontal movement
        if (keyState['d']) {
            myImg.src = "MainCharacterRight.png";
            if (currentLeft + characterWidth < containerWidth) {
                currentLeft += characterSpeed;
                myImg.style.left = currentLeft + 'px';
            }
        }
        if (keyState['a']) {
            myImg.src = "MainCharacterLeft.png";
            if (currentLeft > 0) {
                currentLeft -= characterSpeed;
                myImg.style.left = currentLeft + 'px';
            }
        }

        // Gravity and collision detection
        let isOnPlatform = false;

        platformElements.forEach(platform => {
            const platformRect = platform.getBoundingClientRect();
            const characterRect = myImg.getBoundingClientRect();

            // Convert bounding rects to consistent units
            const platformTop = window.innerHeight - platformRect.top;
            const platformBottom = window.innerHeight - platformRect.bottom;
            const characterTop = window.innerHeight - characterRect.top;
            const characterBottom = window.innerHeight - characterRect.bottom;

            if (
                characterBottom <= platformTop &&
                characterBottom + gravity >= platformTop &&
                characterRect.right > platformRect.left &&
                characterRect.left < platformRect.right
            ) {
                // The character is on this platform
                myImg.style.bottom = platformTop + 'px';
                isOnPlatform = true;
            }
        });

        // Apply gravity if not on a platform and not jumping
        if (!isOnPlatform && !isJumping) {
            currentBottom = Math.max(currentBottom - gravity, 0);
            myImg.style.bottom = currentBottom + 'px';
        }

        requestAnimationFrame(gameLoop);
    }

    function myJump() {
        if (isJumping) return;

        isJumping = true;
        let jumpVelocity = jumpSpeed;

        myImg.src = "MainCharacterJump.png"; // Change sprite for jumping

        function handleJump() {
            const currentBottom = parseInt(myImg.style.bottom) || 0;

            if (jumpVelocity > 0) {
                // Going up
                myImg.style.bottom = currentBottom + jumpVelocity + 'px';
                jumpVelocity -= 1; // Gradual deceleration
                requestAnimationFrame(handleJump);
            } else if (currentBottom > 0) {
                // Falling down
                const newBottom = Math.max(currentBottom - gravity, 0);
                myImg.style.bottom = newBottom + 'px';
                if (newBottom === 0) {
                    // Landed
                    isJumping = false;
                    myImg.src = "MainCharacterRight.png"; // Reset sprite
                } else {
                    requestAnimationFrame(handleJump);
                }
            }
        }

        handleJump();
    }

    // Key controls
    function handleKeyDown(event) {
        keyState[event.key] = true;
        if (event.key === 'w') myJump();
    }

    function handleKeyUp(event) {
        keyState[event.key] = false;
    }

    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);

    // Start the game loop
    gameLoop();
};

