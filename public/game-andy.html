<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy Final Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
            background-color: #add8e6; /* Blue background color for the whole screen */
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #add8e6; /* Blue background color inside the game container */
        }
        #myImg01 {
            position: absolute;
            width: 100px;
            height: 80px;
            left: 10px; /* Starting from the left */
            bottom: 0; /* Spawn at the bottom of the screen */
        }
        #myImg02, #myImg03 {
            position: absolute;
            width: 100px;
            height: 80px;
        }
        .platform {
            position: absolute;
            width: 200px;
            height: 20px;
            background-color: grey;
        }
    </style>
</head>
<body onkeydown="handleKeyDown(event)" onkeyup="handleKeyUp(event)">
    
<div id="gameContainer">
    <h1 align="center" style="position: absolute; top: 20px; width: 100%; color: black;">Andy Final Game</h1>

    <!-- Character -->
    <img id="myImg01" src="MainCharacterRight.png" alt="Main Character" />

    <!-- Win/Lose Triggers -->
    <img id="myImg02" style="top: 500px; left: 250px;" src="myImage02.jpg" alt="Trigger 1" />
    <img id="myImg03" style="top: 50px; left: 400px;" src="myImage03.jpg" alt="Trigger 2" />

    <!-- Platform -->
    <div class="platform" style="bottom: 75px; left: 200px;"></div>
</div>

<script>
    // Existing global variables
    let isJumping = false;
    let keyState = {};
    const characterSpeed = 3;
    const jumpHeight = 130;
    const gravity = 5;

    // New global variables for collision
    let isOnPlatform = false;
    const platform = document.querySelector('.platform');

    // Updated game loop
    function gameLoop() {
        const myImg = document.getElementById("myImg01");
        const gameContainer = document.getElementById("gameContainer");

        let currentLeft = parseInt(myImg.style.left, 10) || 10;
        const currentBottom = parseInt(myImg.style.bottom, 10) || 0;
        const containerWidth = gameContainer.offsetWidth;
        const characterWidth = myImg.offsetWidth;

        // Horizontal movement logic
        if (keyState["d"]) {
            setCharacter("Right");
            if (currentLeft + characterWidth < containerWidth) {
                currentLeft += characterSpeed;
                myImg.style.left = currentLeft + "px";
            }
        }
        if (keyState["a"]) {
            setCharacter("Left");
            if (currentLeft > 0) {
                currentLeft -= characterSpeed;
                myImg.style.left = currentLeft + "px";
            }
        }

        // Gravity and collision detection
        checkPlatformCollision(myImg, platform);

        // Apply gravity if not on a platform or jumping
        if (!isOnPlatform && !isJumping) {
            const newBottom = Math.max(currentBottom - gravity, 0);
            myImg.style.bottom = newBottom + "px";
        }

        requestAnimationFrame(gameLoop);
    }

    // Collision detection logic
    function checkPlatformCollision(character, platform) {
        const charRect = character.getBoundingClientRect();
        const platRect = platform.getBoundingClientRect();

        const onTop = 
            charRect.bottom <= platRect.top && 
            charRect.bottom + gravity >= platRect.top &&
            charRect.right > platRect.left && 
            charRect.left < platRect.right;

        if (onTop) {
            // Snap character to platform
            character.style.bottom = (window.innerHeight - platRect.top - character.offsetHeight) + "px";
            isOnPlatform = true;
        } else {
            // Character is not on top of the platform
            isOnPlatform = false;
        }
    }

    // Updated jump logic
    function myJump() {
        if (isJumping || (!isOnPlatform && parseInt(myImg.style.bottom) === 0)) return;

        isJumping = true;
        const myImg = document.getElementById("myImg01");
        const startPos = parseInt(window.getComputedStyle(myImg).bottom, 10) || 0;
        let currentHeight = 0;

        myImg.src = 'MainCharacterJump.png';

        function jumpUp() {
            if (currentHeight < jumpHeight) {
                currentHeight += gravity;
                myImg.style.bottom = (startPos + currentHeight) + "px";
                requestAnimationFrame(jumpUp);
            } else {
                jumpDown();
            }
        }

        function jumpDown() {
            if (currentHeight > 0) {
                currentHeight -= gravity;
                myImg.style.bottom = (startPos + currentHeight) + "px";
                requestAnimationFrame(jumpDown);
            } else {
                isJumping = false;
                myImg.style.bottom = startPos + "px";
                myImg.src = 'MainCharacterRight.png'; // Reset sprite
            }
        }

        jumpUp();
    }

    // Start the game loop
    gameLoop();
</script>
</body>
</html>
